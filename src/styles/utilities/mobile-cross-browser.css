/**
 * Mobile & Cross-Browser Compatibility
 * Comprehensive fixes for mobile responsiveness and cross-browser support
 * 
 * Covers:
 * - Touch target sizes (minimum 44x44px)
 * - iOS zoom prevention (font-size >= 16px)
 * - Safe area insets (notches, home indicators)
 * - Cross-browser prefixes
 * - Overflow handling
 * - Touch action optimization
 */

/* ========================================
   TOUCH TARGET SIZES (Mobile)
   ======================================== */

/* Touch target sizes removed - using default Tailwind responsive classes */

/* ========================================
   iOS ZOOM PREVENTION
   ======================================== */

/* All input fields must have font-size >= 16px to prevent iOS zoom */
.kalifinder-widget-content input[type='text'],
.kalifinder-widget-content input[type='search'],
.kalifinder-widget-content input[type='email'],
.kalifinder-widget-content input[type='tel'],
.kalifinder-widget-content input[type='number'],
.kalifinder-widget-content input[type='password'],
.kalifinder-widget-content textarea,
.kalifinder-widget-content select {
  font-size: 16px !important;
  -webkit-text-size-adjust: 100% !important;
  -moz-text-size-adjust: 100% !important;
  text-size-adjust: 100% !important;
}

/* Override for larger screens where smaller font is acceptable */
@media (min-width: 768px) {
  .kalifinder-widget-content input[type='text'],
  .kalifinder-widget-content input[type='search'],
  .kalifinder-widget-content input[type='email'],
  .kalifinder-widget-content input[type='tel'],
  .kalifinder-widget-content input[type='number'],
  .kalifinder-widget-content input[type='password'],
  .kalifinder-widget-content textarea {
    font-size: 14px !important;
  }
}

/* ========================================
   SAFE AREA INSETS (iOS Notches & Home Indicators)
   ======================================== */

/* Modal content - respect safe areas and ensure proper viewport handling */
.kalifinder-widget-modal-content {
  /* Respect safe areas on mobile */
  padding-top: env(safe-area-inset-top) !important;
  padding-bottom: env(safe-area-inset-bottom) !important;
  padding-left: env(safe-area-inset-left) !important;
  padding-right: env(safe-area-inset-right) !important;

  /* Ensure modal starts from top of visible viewport */
  top: 0 !important;
  align-self: flex-start !important;
}

/* Use dynamic viewport height when supported (accounts for mobile browser UI) */
@supports (height: 100dvh) {
  .kalifinder-widget-modal-content {
    height: 100dvh !important;
    max-height: 100dvh !important;
  }
}

@media (max-width: 768px) {
  .kalifinder-widget-modal-content {
    /* On mobile, ensure full viewport coverage */
    height: 100vh !important;
    min-height: 100vh !important;
    width: 100% !important;
    max-width: 100% !important;
    max-height: 100vh !important;
    /* Start from top to avoid being hidden by address bar */
    margin-top: 0 !important;
  }

  /* Use dynamic viewport height when supported */
  @supports (height: 100dvh) {
    .kalifinder-widget-modal-content {
      height: 100dvh !important;
      max-height: 100dvh !important;
    }
  }

  .kalifinder-widget-modal {
    /* Ensure modal overlay covers full viewport */
    height: 100vh !important;
    min-height: 100vh !important;
    align-items: flex-start !important;
    padding: 0 !important;
  }

  @supports (height: 100dvh) {
    .kalifinder-widget-modal {
      height: 100dvh !important;
    }
  }
}

/* Header - respect top safe area and ensure visibility above browser UI */
.kalifinder-widget-content .sticky.top-0 {
  padding-top: calc(var(--space-3) + env(safe-area-inset-top)) !important;
  /* Ensure header is always visible, not hidden by browser address bar */
  position: sticky !important;
  top: 0 !important;
  z-index: 50 !important;
  /* Add extra top padding on mobile to account for potential browser UI */
}

@media (max-width: 768px) {
  .kalifinder-widget-content .sticky.top-0 {
    /* Extra padding on mobile to ensure search bar is never hidden */
    padding-top: calc(var(--space-3) + env(safe-area-inset-top) + 2px) !important;
    /* Ensure it stays at the top of the scrollable content */
    top: 0 !important;
  }
}

/* Drawer - respect bottom safe area */
.kalifinder-widget-content [data-radix-drawer-content] {
  padding-bottom: calc(var(--space-4) + env(safe-area-inset-bottom)) !important;
  display: flex !important;
  flex-direction: column !important;
  overflow: hidden !important;
  max-height: 90vh !important;
  height: 90vh !important;
}

/* Ensure drawer footer stays at bottom and doesn't overlap */
.kalifinder-widget-content
  [data-radix-drawer-content]
  > div[class*='flex-shrink-0'][class*='border-t'] {
  flex-shrink: 0 !important;
  margin-top: auto !important;
  background: white !important;
  position: relative !important;
  z-index: 10 !important;
}

/* Drawer scrollable content area */
.kalifinder-widget-content [data-radix-drawer-content] > div[class*='overflow-y-auto'],
.kalifinder-widget-content [data-radix-drawer-content] > div[class*='overscroll-contain'] {
  -webkit-overflow-scrolling: touch !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  flex: 1 1 0% !important;
  min-height: 0 !important;
  /* Ensure proper scrolling on mobile */
  overscroll-behavior-y: contain !important;
  /* Force hardware acceleration for smooth scrolling */
  transform: translateZ(0) !important;
  will-change: scroll-position !important;
}

/* Trigger button - respect safe areas */
.kalifinder-trigger-button {
  top: calc(80px + env(safe-area-inset-top)) !important;
  right: calc(30px + env(safe-area-inset-right)) !important;
}

@media (max-width: 640px) {
  .kalifinder-trigger-button {
    top: calc(70px + env(safe-area-inset-top)) !important;
    right: calc(20px + env(safe-area-inset-right)) !important;
  }
}

/* ========================================
   TOUCH ACTION OPTIMIZATION
   ======================================== */

/* Improve touch responsiveness */
.kalifinder-widget-content button,
.kalifinder-widget-content [role='button'],
.kalifinder-widget-content a,
.kalifinder-widget-content input[type='checkbox'],
.kalifinder-widget-content input[type='radio'],
.kalifinder-widget-content label {
  -webkit-tap-highlight-color: rgba(124, 58, 237, 0.2) !important;
  tap-highlight-color: rgba(124, 58, 237, 0.2) !important;
  touch-action: manipulation !important;
  -webkit-touch-callout: none !important;
}

/* Prevent text selection on buttons */
.kalifinder-widget-content button,
.kalifinder-widget-content [role='button'] {
  -webkit-user-select: none !important;
  -moz-user-select: none !important;
  -ms-user-select: none !important;
  user-select: none !important;
}

/* ========================================
   OVERFLOW HANDLING (Mobile)
   ======================================== */

/* Prevent horizontal overflow */
.kalifinder-widget-content,
.kalifinder-widget-content > div,
.kalifinder-widget-content main,
.kalifinder-widget-content aside {
  overflow-x: hidden !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
}

/* Allow vertical scrolling where needed */
.kalifinder-widget-content {
  overflow-y: auto !important;
  -webkit-overflow-scrolling: touch !important;
}

/* Modal content scrolling */
.kalifinder-widget-modal-content {
  overflow-y: auto !important;
  -webkit-overflow-scrolling: touch !important;
  overscroll-behavior: contain !important;
}

/* Product grid - prevent overflow */
.kalifinder-product-grid {
  overflow: hidden !important;
  width: 100% !important;
  max-width: 100% !important;
}

/* ========================================
   CROSS-BROWSER COMPATIBILITY
   ======================================== */

/* Flexbox fallbacks */
.kalifinder-widget-content .flex {
  display: -webkit-box !important;
  display: -webkit-flex !important;
  display: -ms-flexbox !important;
  display: flex !important;
}

/* Grid fallbacks */
.kalifinder-product-grid {
  display: -ms-grid !important;
  display: grid !important;
}

/* Backdrop filter fallback */
.kalifinder-widget-modal {
  background: rgba(0, 0, 0, 0.5) !important;
}

@supports (backdrop-filter: blur(4px)) {
  .kalifinder-widget-modal {
    -webkit-backdrop-filter: blur(4px) !important;
    backdrop-filter: blur(4px) !important;
  }
}

/* Border radius fallbacks - removed inherit to preserve actual border-radius values */
/* Note: Tailwind's rounded classes already handle border-radius correctly */

/* Transform fallbacks */
.kalifinder-widget-content [class*='transform'],
.kalifinder-widget-content [class*='scale'],
.kalifinder-widget-content [class*='rotate'] {
  -webkit-transform: inherit !important;
  -moz-transform: inherit !important;
  -ms-transform: inherit !important;
  transform: inherit !important;
}

/* Transition fallbacks */
.kalifinder-widget-content * {
  -webkit-transition: inherit !important;
  -moz-transition: inherit !important;
  -o-transition: inherit !important;
  transition: inherit !important;
}

/* ========================================
   MOBILE-SPECIFIC COMPONENT FIXES
   ======================================== */

/* Mobile-specific fixes removed - using default Tailwind responsive classes */

/* ========================================
   TABLET OPTIMIZATIONS
   ======================================== */

@media (min-width: 768px) and (max-width: 1023px) {
  /* Slightly larger touch targets on tablets */
  .kalifinder-widget-content button,
  .kalifinder-widget-content [role='button'] {
    min-height: 40px !important;
    min-width: 40px !important;
  }

  /* Product grid - 3 columns on tablet */
  .kalifinder-product-grid {
    grid-template-columns: repeat(3, 1fr) !important;
  }
}

/* ========================================
   ACCESSIBILITY IMPROVEMENTS
   ======================================== */

/* Focus indicators - visible on all browsers */
/* Apply to buttons and interactive elements, but exclude form inputs */
.kalifinder-widget-content button:focus-visible,
.kalifinder-widget-content [role='button']:focus-visible,
.kalifinder-widget-content a:focus-visible,
.kalifinder-widget-content [tabindex]:focus-visible {
  outline: 2px solid var(--primary) !important;
  outline-offset: 2px !important;
  -webkit-outline: 2px solid var(--primary) !important;
}

/* Search input should not show outline - it uses border color change instead */
.kalifinder-widget-content [role='search'] input:focus,
.kalifinder-widget-content [role='search'] input:focus-visible,
.kalifinder-widget-content input[id='search-input']:focus,
.kalifinder-widget-content input[id='search-input']:focus-visible,
.kalifinder-widget-content input:focus,
.kalifinder-widget-content input:focus-visible,
.kalifinder-widget-content textarea:focus,
.kalifinder-widget-content textarea:focus-visible,
.kalifinder-widget-content select:focus,
.kalifinder-widget-content select:focus-visible {
  outline: none !important;
  -webkit-outline: none !important;
  box-shadow: none !important;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .kalifinder-widget-content {
    border-width: 2px !important;
  }

  .kalifinder-widget-content button {
    border: 2px solid currentColor !important;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .kalifinder-widget-content *,
  .kalifinder-widget-content *::before,
  .kalifinder-widget-content *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ========================================
   VIEWPORT FIXES
   ======================================== */

/* Ensure proper viewport handling */
.kalifinder-widget-root {
  width: 100% !important;
  max-width: 100vw !important;
  overflow-x: hidden !important;
}

.kalifinder-widget-modal {
  width: 100vw !important;
  max-width: 100vw !important;
  left: 0 !important;
  right: 0 !important;
  /* Ensure modal starts from top of viewport, not behind address bar */
  top: 0 !important;
  bottom: 0 !important;
}

@media (max-width: 768px) {
  .kalifinder-widget-modal {
    /* On mobile, ensure modal is positioned at top of visible viewport */
    /* Safe area insets are already handled in padding */
    top: 0 !important;
  }

  .kalifinder-widget-modal-content {
    /* Ensure content starts from top, accounting for safe areas */
    margin-top: 0 !important;
    /* Ensure it's not hidden behind browser UI */
    position: relative !important;
    /* Ensure proper alignment */
    align-self: flex-start !important;
  }
}

/* Prevent body scroll when modal is open */
body.kalifinder-open {
  overflow: hidden !important;
  position: fixed !important;
  width: 100% !important;
  height: 100% !important;
  /* On mobile, prevent scroll that might hide content */
  top: 0 !important;
  left: 0 !important;
}

/* ========================================
   FLOATING ACTION BUTTONS (Mobile)
   ======================================== */

/* Ensure Filter and KaliFinder buttons are aligned and same size on mobile */
/* Mobile-specific button styles removed - using default Tailwind responsive classes */

/* Tablet and up - maintain alignment */
@media (min-width: 640px) and (max-width: 1023px) {
  .kalifinder-widget-content > div > div[class*='fixed'][class*='bottom'] button,
  .kalifinder-widget-content > div > div[class*='fixed'][class*='bottom'] a {
    min-height: 40px !important;
    padding: 0.5rem 0.75rem !important; /* py-2 px-3 */
  }
}

/* ========================================
   IMAGE OPTIMIZATION (Mobile)
   ======================================== */

/* Image optimization - using default responsive classes */

/* ========================================
   TEXT RENDERING OPTIMIZATION
   ======================================== */

.kalifinder-widget-content {
  -webkit-font-smoothing: antialiased !important;
  -moz-osx-font-smoothing: grayscale !important;
  text-rendering: optimizeLegibility !important;
}

/* Prevent text overflow */
.kalifinder-widget-content [class*='line-clamp'],
.kalifinder-widget-content [class*='truncate'] {
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  display: -webkit-box !important;
  -webkit-line-clamp: inherit !important;
  -webkit-box-orient: vertical !important;
}
