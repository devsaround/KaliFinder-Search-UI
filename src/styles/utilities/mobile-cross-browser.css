/**
 * Mobile & Cross-Browser Compatibility
 * Comprehensive fixes for mobile responsiveness and cross-browser support
 * 
 * Covers:
 * - Touch target sizes (minimum 44x44px for accessibility)
 * - iOS zoom prevention (font-size >= 16px)
 * - Safe area insets (notches, home indicators)
 * - Cross-browser prefixes (-webkit, -moz, -ms)
 * - Overflow handling and momentum scrolling
 * - Touch action optimization
 * - Viewport fixes for mobile browsers
 */

/* ========================================
   TOUCH TARGET SIZES (Mobile Accessibility)
   ======================================== */

/* Touch target handling removed - Tailwind utilities handle this properly */

/* ========================================
   iOS ZOOM PREVENTION
   ======================================== */

/* All input fields must have font-size >= 16px to prevent iOS zoom */
.kalifinder-widget-content input[type='text'],
.kalifinder-widget-content input[type='search'],
.kalifinder-widget-content input[type='email'],
.kalifinder-widget-content input[type='tel'],
.kalifinder-widget-content input[type='number'],
.kalifinder-widget-content input[type='password'],
.kalifinder-widget-content textarea,
.kalifinder-widget-content select {
  font-size: 16px !important;
  -webkit-text-size-adjust: 100% !important;
  -moz-text-size-adjust: 100% !important;
  text-size-adjust: 100% !important;
  /* Prevent iOS from adding default styling */
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  /* Better touch handling */
  touch-action: manipulation;
}

/* Override for larger screens where smaller font is acceptable */
@media (min-width: 768px) {
  .kalifinder-widget-content input[type='text'],
  .kalifinder-widget-content input[type='search'],
  .kalifinder-widget-content input[type='email'],
  .kalifinder-widget-content input[type='tel'],
  .kalifinder-widget-content input[type='number'],
  .kalifinder-widget-content input[type='password'],
  .kalifinder-widget-content textarea {
    font-size: 14px !important;
  }
}

/* ========================================
   SAFE AREA INSETS (iOS Notches & Home Indicators)
   ======================================== */

/**
 * Modal content padding approach - DO NOT CONFUSE with shadow-dom-fixed.css
 * 
 * This file: Adds PADDING to modal content for safe areas
 * shadow-dom-fixed.css: Uses calc() BOTTOM offset for floating containers
 * 
 * Both are needed and serve different purposes - not redundant!
 */

/* Modal content - respect safe areas and ensure proper viewport handling */
.kalifinder-widget-modal-content {
  /* Respect safe areas on mobile */
  padding-top: env(safe-area-inset-top) !important;
  padding-bottom: env(safe-area-inset-bottom) !important;
  padding-left: env(safe-area-inset-left) !important;
  padding-right: env(safe-area-inset-right) !important;

  /* Ensure modal starts from top of visible viewport */
  top: 0 !important;
  align-self: flex-start !important;
}

/* Use dynamic viewport height when supported (accounts for mobile browser UI) */
@supports (height: 100dvh) {
  .kalifinder-widget-modal-content {
    height: 100dvh !important;
    max-height: 100dvh !important;
  }
}

@media (max-width: 768px) {
  .kalifinder-widget-modal-content {
    /* On mobile, ensure full viewport coverage */
    height: 100vh !important;
    min-height: 100vh !important;
    min-height: -webkit-fill-available !important; /* iOS Safari fix */
    width: 100% !important;
    max-width: 100% !important;
    max-height: 100vh !important;
    /* Start from top to avoid being hidden by address bar */
    margin-top: 0 !important;
    /* Prevent pull-to-refresh on mobile */
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
  }

  /* Use dynamic viewport height when supported */
  @supports (height: 100dvh) {
    .kalifinder-widget-modal-content {
      height: 100dvh !important;
      max-height: 100dvh !important;
    }
  }

  .kalifinder-widget-modal {
    /* Ensure modal overlay covers full viewport */
    height: 100vh !important;
    min-height: 100vh !important;
    align-items: flex-start !important;
    padding: 0 !important;
  }

  @supports (height: 100dvh) {
    .kalifinder-widget-modal {
      height: 100dvh !important;
    }
  }
}

/* Header - respect top safe area and ensure visibility above browser UI */
.kalifinder-widget-content .sticky.top-0 {
  padding-top: calc(var(--space-3) + env(safe-area-inset-top)) !important;
  /* Ensure header is always visible, not hidden by browser address bar */
  top: 0 !important;
  z-index: 50 !important;
  /* Add extra top padding on mobile to account for potential browser UI */
}

@media (max-width: 768px) {
  .kalifinder-widget-content .sticky.top-0 {
    /* Extra padding on mobile to ensure search bar is never hidden */
    padding-top: calc(var(--space-3) + env(safe-area-inset-top) + 2px) !important;
    /* Ensure it stays at the top of the scrollable content */
    top: 0 !important;
  }
}

/* Drawer - respect bottom safe area */
.kalifinder-widget-content [data-radix-drawer-content] {
  padding-bottom: calc(var(--space-4) + env(safe-area-inset-bottom)) !important;
  display: flex !important;
  flex-direction: column !important;
  overflow: hidden !important;
  max-height: 90vh !important;
  height: 90vh !important;
}

/* Ensure drawer footer stays at bottom and doesn't overlap */
.kalifinder-widget-content
  [data-radix-drawer-content]
  > div[class*='flex-shrink-0'][class*='border-t'] {
  flex-shrink: 0 !important;
  margin-top: auto !important;
  background: white !important;
  position: relative !important;
  z-index: 10 !important;
}

/* Drawer scrollable content area */
.kalifinder-widget-content [data-radix-drawer-content] > div[class*='overflow-y-auto'],
.kalifinder-widget-content [data-radix-drawer-content] > div[class*='overscroll-contain'] {
  -webkit-overflow-scrolling: touch !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  flex: 1 1 0% !important;
  min-height: 0 !important;
  overscroll-behavior-y: contain !important;
}

/* Trigger button - respect safe areas */
.kalifinder-trigger-button {
  top: calc(80px + env(safe-area-inset-top)) !important;
  right: calc(30px + env(safe-area-inset-right)) !important;
}

@media (max-width: 640px) {
  .kalifinder-trigger-button {
    top: calc(70px + env(safe-area-inset-top)) !important;
    right: calc(20px + env(safe-area-inset-right)) !important;
  }
}

/* ========================================
   TOUCH ACTION OPTIMIZATION
   ======================================== */

/* Touch action handling removed - Tailwind utilities handle this */

/* ========================================
   OVERFLOW HANDLING (Mobile)
   ======================================== */

/* Overflow handling removed - Tailwind utilities handle this properly */

/* ========================================
   CROSS-BROWSER COMPATIBILITY
   ======================================== */

/* Backdrop filter fallback */
.kalifinder-widget-modal {
  background: rgba(0, 0, 0, 0.5) !important;
}

@supports (backdrop-filter: blur(4px)) {
  .kalifinder-widget-modal {
    -webkit-backdrop-filter: blur(4px) !important;
    backdrop-filter: blur(4px) !important;
  }
}

/* ========================================
   MOBILE-SPECIFIC COMPONENT FIXES
   ======================================== */

/* Mobile-specific fixes removed - using default Tailwind responsive classes */

/* ========================================
   TABLET OPTIMIZATIONS
   ======================================== */

/* Tablet-specific overrides removed - using Tailwind responsive classes */

/* ========================================
   ACCESSIBILITY IMPROVEMENTS
   ======================================== */

/* Focus indicators - visible on all browsers */
/* Apply to buttons and interactive elements, but exclude form inputs */
.kalifinder-widget-content button:focus-visible,
.kalifinder-widget-content [role='button']:focus-visible,
.kalifinder-widget-content a:focus-visible,
.kalifinder-widget-content [tabindex]:focus-visible {
  outline: 2px solid var(--primary) !important;
  outline-offset: 2px !important;
  -webkit-outline: 2px solid var(--primary) !important;
}

/* Search input should not show outline - it uses border color change instead */
.kalifinder-widget-content [role='search'] input:focus,
.kalifinder-widget-content [role='search'] input:focus-visible,
.kalifinder-widget-content input[id='search-input']:focus,
.kalifinder-widget-content input[id='search-input']:focus-visible,
.kalifinder-widget-content input:focus,
.kalifinder-widget-content input:focus-visible,
.kalifinder-widget-content textarea:focus,
.kalifinder-widget-content textarea:focus-visible,
.kalifinder-widget-content select:focus,
.kalifinder-widget-content select:focus-visible {
  outline: none !important;
  -webkit-outline: none !important;
  box-shadow: none !important;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .kalifinder-widget-content {
    border-width: 2px !important;
  }

  .kalifinder-widget-content button {
    border: 2px solid currentColor !important;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .kalifinder-widget-content *,
  .kalifinder-widget-content *::before,
  .kalifinder-widget-content *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ========================================
   VIEWPORT FIXES
   ======================================== */

/* Viewport fixes removed - handled by widget-container.css */

/* Prevent body scroll when modal is open */
body.kalifinder-open {
  overflow: hidden !important;
  position: fixed !important;
  width: 100% !important;
  height: 100% !important;
  /* On mobile, prevent scroll that might hide content */
  top: 0 !important;
  left: 0 !important;
}

/* ========================================
   FLOATING ACTION BUTTONS (Mobile)
   ======================================== */

/* Mobile-specific button styles removed - using default Tailwind responsive classes */

/* ========================================
   IMAGE OPTIMIZATION (Mobile)
   ======================================== */

/* Image optimization - using default responsive classes */

/* ========================================
   TEXT RENDERING OPTIMIZATION
   ======================================== */

/* Text rendering removed - Tailwind handles this */

/* ========================================
   MOBILE DRAWER IMPROVEMENTS
   ======================================== */

/* Ensure drawer content is fully scrollable on mobile */
@media (max-width: 768px) {
  [data-radix-drawer-content] {
    touch-action: pan-y !important;
    -webkit-overflow-scrolling: touch !important;
  }

  /* Drawer scrollable area - force scrollbars to be visible */
  [data-radix-drawer-content] .overflow-y-scroll,
  [data-radix-drawer-content] [class*='overflow-y-scroll'] {
    overflow-y: scroll !important; /* Force scroll instead of auto */
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior: contain !important;

    /* Make scrollbar always visible on mobile */
    scrollbar-width: thin !important;
    scrollbar-color: rgba(0, 0, 0, 0.3) transparent !important;
  }

  /* Webkit scrollbar styling for mobile */
  [data-radix-drawer-content] .overflow-y-scroll::-webkit-scrollbar,
  [data-radix-drawer-content] [class*='overflow-y-scroll']::-webkit-scrollbar {
    width: 6px !important;
    height: 6px !important;
  }

  [data-radix-drawer-content] .overflow-y-scroll::-webkit-scrollbar-track,
  [data-radix-drawer-content] [class*='overflow-y-scroll']::-webkit-scrollbar-track {
    background: transparent !important;
  }

  [data-radix-drawer-content] .overflow-y-scroll::-webkit-scrollbar-thumb,
  [data-radix-drawer-content] [class*='overflow-y-scroll']::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.3) !important;
    border-radius: 3px !important;
  }

  [data-radix-drawer-content] .overflow-y-scroll::-webkit-scrollbar-thumb:hover,
  [data-radix-drawer-content] [class*='overflow-y-scroll']::-webkit-scrollbar-thumb:hover {
    background-color: rgba(0, 0, 0, 0.4) !important;
  }
}

/* ========================================
   ACCORDION & COLLAPSIBLE IMPROVEMENTS
   ======================================== */

/* Ensure accordion content is accessible and scrollable */
.kalifinder-widget-content [data-radix-accordion-content] {
  overflow: hidden !important;
  transition: height 200ms cubic-bezier(0.4, 0, 0.2, 1) !important;
}

@media (max-width: 768px) {
  .kalifinder-widget-content [data-radix-accordion-content][data-state='open'] {
    /* Allow scrolling if content is long */
    overflow-y: auto !important;
    max-height: 400px !important;
    -webkit-overflow-scrolling: touch !important;
  }
}

/* ========================================
   MODAL & DIALOG IMPROVEMENTS
   ======================================== */

/* Ensure modals are properly centered and sized on mobile */
@media (max-width: 768px) {
  [data-radix-dialog-content],
  [data-radix-dialog-overlay] {
    position: fixed !important;
    inset: 0 !important;
  }

  [data-radix-dialog-content] {
    max-width: 100% !important;
    max-height: 100% !important;
    border-radius: 0 !important;
    margin: 0 !important;
  }
}

/* ========================================
   SLIDER & RANGE INPUT IMPROVEMENTS
   ======================================== */

/* Ensure slider touch targets are large enough */
.kalifinder-widget-content input[type='range'] {
  -webkit-appearance: none !important;
  appearance: none !important;
  width: 100% !important;
  height: 40px !important; /* Large enough for touch */
  cursor: pointer !important;
  touch-action: pan-x !important;
}

.kalifinder-widget-content input[type='range']::-webkit-slider-thumb {
  -webkit-appearance: none !important;
  appearance: none !important;
  width: 24px !important;
  height: 24px !important;
  border-radius: 50% !important;
  cursor: pointer !important;
}

.kalifinder-widget-content input[type='range']::-moz-range-thumb {
  width: 24px !important;
  height: 24px !important;
  border-radius: 50% !important;
  cursor: pointer !important;
  border: none !important;
}

/* ========================================
   CHECKBOX & RADIO IMPROVEMENTS
   ======================================== */

/* Checkbox/radio sizing removed - custom checkbox component handles this */

/* ========================================
   PERFORMANCE OPTIMIZATIONS
   ======================================== */

/* Optimize scrolling performance */
.kalifinder-widget-content [class*='overflow-y-auto'],
.kalifinder-widget-content [class*='overflow-auto'] {
  -webkit-overflow-scrolling: touch !important;
  scroll-behavior: smooth !important;
}

/* ========================================
   SAFARI-SPECIFIC FIXES
   ======================================== */

/* Fix for Safari's 100vh issue */
@supports (-webkit-touch-callout: none) {
  .kalifinder-widget-modal-content {
    min-height: -webkit-fill-available !important;
  }

  @media (max-width: 768px) {
    .kalifinder-widget-modal-content {
      height: -webkit-fill-available !important;
    }
  }
}

/* ========================================
   FIREFOX-SPECIFIC FIXES
   ======================================== */

/* Ensure proper scrollbar styling in Firefox */
@-moz-document url-prefix() {
  .kalifinder-widget-content [class*='overflow-y-auto'],
  .kalifinder-widget-content [class*='overflow-auto'] {
    scrollbar-width: thin !important;
    scrollbar-color: rgba(0, 0, 0, 0.2) transparent !important;
  }
}
