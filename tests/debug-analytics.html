<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Analytics</title>
</head>
<body>
    <h1>Debug Analytics Test</h1>
    <p>This page helps debug the analytics flow between search and dashboard.</p>
    
    <div>
        <h2>Test Search Script with Vendor ID</h2>
        <p>Use this script tag with vendor ID and store ID parameters:</p>
        <pre><code>&lt;script src="http://localhost:5173/kalifind-search.js?storeUrl=https://findifly.kinsta.cloud&vendorId=YOUR_VENDOR_ID&storeId=YOUR_STORE_ID"&gt;&lt;/script&gt;</code></pre>
    </div>
    
    <div>
        <h2>Test UBI Client Directly</h2>
        <button onclick="testUBIClient()">Test UBI Client</button>
        <div id="ubi-results"></div>
    </div>
    
    <div>
        <h2>Test Analytics Endpoint</h2>
        <button onclick="testAnalyticsEndpoint()">Test Analytics Endpoint</button>
        <div id="analytics-results"></div>
    </div>

    <script>
        // Set test vendor and store IDs
        window.KALIFIND_VENDOR_ID = 'test-vendor-123';
        window.KALIFIND_STORE_ID = 'test-store-456';
        
        function testUBIClient() {
            try {
                // Import and test UBI client
                import('./src/analytics/ubiClient.js').then(({ getUBIClient }) => {
                    const ubiClient = getUBIClient();
                    
                    console.log('Testing UBI Client...');
                    ubiClient.trackSearchSubmitted('test query');
                    ubiClient.trackResultClick('test-product-123', 1);
                    ubiClient.trackAddToCart('test-product-123', 'Test Product', 29.99, 1);
                    
                    document.getElementById('ubi-results').innerHTML = 
                        '<p style="color: green;">UBI Client test completed. Check console for details.</p>';
                }).catch(error => {
                    console.error('Failed to import UBI client:', error);
                    document.getElementById('ubi-results').innerHTML = 
                        '<p style="color: red;">Failed to import UBI client: ' + error.message + '</p>';
                });
            } catch (error) {
                console.error('Error testing UBI client:', error);
                document.getElementById('ubi-results').innerHTML = 
                    '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }
        
        function testAnalyticsEndpoint() {
            const backendUrl = 'http://localhost:3000'; // Adjust as needed
            const vendorId = 'test-vendor-123';
            
            fetch(`${backendUrl}/v1/analytics/vendor/${vendorId}/dashboard`, {
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                console.log('Analytics endpoint response:', data);
                document.getElementById('analytics-results').innerHTML = 
                    '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            })
            .catch(error => {
                console.error('Analytics endpoint error:', error);
                document.getElementById('analytics-results').innerHTML = 
                    '<p style="color: red;">Error: ' + error.message + '</p>';
            });
        }
        
        // Auto-test on page load
        window.addEventListener('load', () => {
            console.log('Debug page loaded');
            console.log('Vendor ID:', window.KALIFIND_VENDOR_ID);
            console.log('Store ID:', window.KALIFIND_STORE_ID);
        });
    </script>
</body>
</html>
